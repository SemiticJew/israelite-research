<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Events — Semitic Jew</title>
  <link rel="stylesheet" href="/israelite-research/styles.css" />
  <style>
    /* ===== Scoped calendar styles (stay on this page only) ===== */
    .events-page .container{max-width:1200px;margin:0 auto;padding:0 16px;}
    .events-page .calendar-wrap{max-width:1000px;margin:0 auto 40px;}

    .events-page .page-header{padding:24px 0 8px;}
    .events-page .page-title{margin:0;font-size:2rem;font-weight:800;}

    .cal-toolbar{display:flex;align-items:center;justify-content:space-between;gap:.75rem;margin:1rem 0 1.25rem;}
    .cal-title{font-size:1.25rem;margin:0;font-weight:700;}
    .cal-nav{display:flex;gap:.5rem;}
    .btn{padding:.45rem .7rem;border:1px solid #e6ebf2;background:#fff;border-radius:10px;cursor:pointer}
    .btn:hover{background:#f8fafc}

    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-dow{background:#f8fafc;border:1px solid #e6ebf2;border-radius:10px;padding:.4rem 0;text-align:center;font-weight:600;color:#555}
    .cal-cell{min-height:110px;border:1px solid #e6ebf2;border-radius:10px;background:#fff;padding:.5rem;display:flex;flex-direction:column}
    .cal-cell.is-today{outline:2px solid var(--accent,#F17300)}
    .cal-date{font-size:.9rem;color:#333;margin-bottom:.35rem}
    .cal-empty{opacity:.35}

    .evt-chip{font-size:.82rem;line-height:1.2;background:#054A910D;border:1px solid #e6ebf2;border-radius:8px;padding:.25rem .35rem;margin:.15rem 0;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .cal-legend{display:flex;gap:.5rem;align-items:center;margin:.75rem 0 0;color:#666;font-size:.9rem}
    .dot{width:10px;height:10px;border-radius:50%;background:#054A91;display:inline-block}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:1rem;z-index:9999}
    .modal.open{display:flex}
    .modal-card{width:min(560px,92vw);background:#fff;border-radius:14px;border:1px solid #e6ebf2;box-shadow:0 8px 30px rgba(0,0,0,.12);overflow:hidden}
    .modal-head{display:flex;align-items:center;justify-content:space-between;padding:1rem 1rem .5rem 1rem;border-bottom:1px solid #eef2f7}
    .modal-title{font-size:1.1rem;margin:0}
    .modal-body{padding:1rem;display:grid;gap:.6rem}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
    label{font-size:.9rem;color:#333}
    input[type="text"],input[type="date"],input[type="time"],textarea{
      width:100%;border:1px solid #e6ebf2;border-radius:10px;padding:.55rem .65rem;font:inherit
    }
    textarea{min-height:90px;resize:vertical}
    .modal-foot{display:flex;justify-content:space-between;gap:.5rem;padding:0 1rem 1rem}
    .btn-primary{background:var(--accent,#F17300);color:#fff;border-color:transparent}
    .btn-danger{border-color:#ffd8d8;background:#fff;color:#b42318}
    .btn-ghost{background:transparent}
    .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}
  </style>
</head>
<body class="events-page">
  <!-- Header partial -->
  <div id="site-header"></div>

  <main>
    <!-- Simple title (no universal hero, no breadcrumbs) -->
    <header class="page-header">
      <div class="container">
        <h1 class="page-title">Events</h1>
      </div>
    </header>

    <!-- Calendar -->
    <div class="calendar-wrap">
      <div class="cal-toolbar">
        <div class="cal-nav">
          <button class="btn" id="prevBtn" aria-label="Previous month">‹ Prev</button>
          <button class="btn" id="todayBtn" aria-label="Jump to today">Today</button>
          <button class="btn" id="nextBtn" aria-label="Next month">Next ›</button>
        </div>
        <h2 class="cal-title" id="calTitle">Month YYYY</h2>
        <button class="btn btn-primary" id="addEventBtn">+ Add Event</button>
      </div>

      <div class="cal-grid" id="dowRow">
        <div class="cal-dow">Sun</div>
        <div class="cal-dow">Mon</div>
        <div class="cal-dow">Tue</div>
        <div class="cal-dow">Wed</div>
        <div class="cal-dow">Thu</div>
        <div class="cal-dow">Fri</div>
        <div class="cal-dow">Sat</div>
      </div>

      <div class="cal-grid" id="calGrid" aria-live="polite"></div>

      <div class="cal-legend">
        <span class="dot"></span> Event
      </div>
    </div>
  </main>

  <!-- Footer partial -->
  <div id="site-footer"></div>

  <!-- Add/Edit Event Modal -->
  <div class="modal" id="eventModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <div class="modal-head">
        <h3 class="modal-title" id="modalTitle">Add Event</h3>
        <button class="btn btn-ghost" id="closeModal" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div>
            <label for="evtDate">Date</label>
            <input type="date" id="evtDate" />
          </div>
          <div>
            <label for="evtTime">Time <span class="muted">(optional)</span></label>
            <input type="time" id="evtTime" />
          </div>
        </div>
        <div>
          <label for="evtTitle">Title</label>
          <input type="text" id="evtTitle" placeholder="e.g., Bible Study" />
        </div>
        <div>
          <label for="evtDesc">Description <span class="muted">(optional)</span></label>
          <textarea id="evtDesc" placeholder="Notes, location, link…"></textarea>
        </div>
      </div>
      <div class="modal-foot">
        <button class="btn btn-danger" id="deleteEvent" style="display:none">Delete</button>
        <div style="margin-left:auto;display:flex;gap:.5rem">
          <button class="btn" id="cancelEvent">Cancel</button>
          <button class="btn btn-primary" id="saveEvent">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Partials include -->
  <script src="/israelite-research/js/include.js"></script>

  <!-- Minimal calendar logic (localStorage-based) -->
  <script>
    (function(){
      const grid = document.getElementById('calGrid');
      const titleEl = document.getElementById('calTitle');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const todayBtn = document.getElementById('todayBtn');
      const addEventBtn = document.getElementById('addEventBtn');

      const modal = document.getElementById('eventModal');
      const closeModal = document.getElementById('closeModal');
      const cancelEvent = document.getElementById('cancelEvent');
      const saveEvent = document.getElementById('saveEvent');
      const deleteEventBtn = document.getElementById('deleteEvent');

      const evtDate = document.getElementById('evtDate');
      const evtTime = document.getElementById('evtTime');
      const evtTitle = document.getElementById('evtTitle');
      const evtDesc = document.getElementById('evtDesc');
      const modalTitle = document.getElementById('modalTitle');

      const STORAGE_KEY = 'ir_events_v1'; // localStorage key
      let events = loadEvents();
      let current = new Date();
      let editingId = null;

      function loadEvents(){
        try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
        catch(e){ return []; }
      }
      function saveEvents(){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
      }

      function startOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
      function endOfMonth(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0); }
      function pad(n){ return String(n).padStart(2,'0'); }
      function fmtDate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }

      function render(){
        const first = startOfMonth(current);
        const last  = endOfMonth(current);
        const startDow = first.getDay();
        const totalDays = last.getDate();

        titleEl.textContent = first.toLocaleString(undefined, {month:'long', year:'numeric'});

        grid.innerHTML = '';
        // Create leading blanks
        for(let i=0;i<startDow;i++){
          const cell = document.createElement('div');
          cell.className = 'cal-cell cal-empty';
          grid.appendChild(cell);
        }
        // Create day cells
        const todayStr = fmtDate(new Date());
        for(let day=1; day<=totalDays; day++){
          const cell = document.createElement('div');
          cell.className = 'cal-cell';
          const dateObj = new Date(current.getFullYear(), current.getMonth(), day);
          const dateStr = fmtDate(dateObj);
          if(dateStr === todayStr) cell.classList.add('is-today');

          const dateEl = document.createElement('div');
          dateEl.className = 'cal-date';
          dateEl.textContent = day;
          cell.appendChild(dateEl);

          // events for this day
          const dayEvents = events.filter(e => e.date === dateStr);
          dayEvents.slice(0,3).forEach(e => {
            const chip = document.createElement('div');
            chip.className = 'evt-chip';
            chip.textContent = e.time ? `${e.time} — ${e.title}` : e.title;
            chip.title = e.desc || '';
            chip.addEventListener('click', (ev) => { ev.preventDefault(); openEdit(e); });
            cell.appendChild(chip);
          });
          if(dayEvents.length > 3){
            const more = document.createElement('div');
            more.className = 'evt-chip';
            more.textContent = `+${dayEvents.length-3} more`;
            more.addEventListener('click', (ev)=>{ ev.preventDefault(); openAdd(dateStr); });
            cell.appendChild(more);
          }

          // click empty area to add
          cell.addEventListener('click', (ev)=>{
            // avoid when clicking a chip (already handled)
            if(ev.target.classList.contains('evt-chip')) return;
            openAdd(dateStr);
          });

          grid.appendChild(cell);
        }
      }

      function openAdd(dateStr){
        editingId = null;
        modalTitle.textContent = 'Add Event';
        evtDate.value = dateStr || fmtDate(new Date());
        evtTime.value = '';
        evtTitle.value = '';
        evtDesc.value = '';
        deleteEventBtn.style.display = 'none';
        modal.classList.add('open');
        evtTitle.focus();
      }

      function openEdit(e){
        editingId = e.id;
        modalTitle.textContent = 'Edit Event';
        evtDate.value = e.date;
        evtTime.value = e.time || '';
        evtTitle.value = e.title || '';
        evtDesc.value = e.desc || '';
        deleteEventBtn.style.display = 'inline-block';
        modal.classList.add('open');
        evtTitle.focus();
      }

      function close(){
        modal.classList.remove('open');
      }

      function onSave(){
        const date = evtDate.value;
        const title = evtTitle.value.trim();
        const time = evtTime.value.trim();
        const desc = evtDesc.value.trim();
        if(!date || !title){ alert('Please provide a date and title.'); return; }

        if(editingId){
          const idx = events.findIndex(x => x.id === editingId);
          if(idx >= 0){ events[idx] = { ...events[idx], date, title, time, desc }; }
        }else{
          const id = 'evt_' + Math.random().toString(36).slice(2,9);
          events.push({ id, date, title, time, desc });
        }
        saveEvents(); close(); render();
      }

      function onDelete(){
        if(!editingId) return;
        events = events.filter(x => x.id !== editingId);
        saveEvents(); close(); render();
      }

      // Nav
      prevBtn.addEventListener('click', ()=>{ current.setMonth(current.getMonth()-1); render(); });
      nextBtn.addEventListener('click', ()=>{ current.setMonth(current.getMonth()+1); render(); });
      todayBtn.addEventListener('click', ()=>{ current = new Date(); render(); });
      addEventBtn.addEventListener('click', ()=> openAdd(fmtDate(new Date())));

      // Modal control
      closeModal.addEventListener('click', close);
      cancelEvent.addEventListener('click', close);
      deleteEventBtn.addEventListener('click', onDelete);
      saveEvent.addEventListener('click', onSave);
      modal.addEventListener('click', (e)=>{ if(e.target === modal) close(); });

      // Init
      render();
    })();
  </script>
</body>
</html>
