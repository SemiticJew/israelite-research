<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Events — Semitic Jew</title>
<link href="/israelite-research/styles.css" rel="stylesheet"/>
<style>
  /* Scoped calendar styles */
  .events-page .container{max-width:1200px;margin:0 auto;padding:0 16px;}
  .events-page .calendar-wrap{max-width:1000px;margin:0 auto 40px;}
  .events-page .page-header{padding:24px 0 8px;}
  .events-page .page-title{margin:0;font-size:2rem;font-weight:800;}
  .cal-toolbar{display:flex;align-items:center;justify-content:space-between;gap:.75rem;margin:1rem 0 1.25rem;}
  .cal-title{font-size:1.25rem;margin:0;font-weight:700;}
  .cal-nav{display:flex;gap:.5rem;}
  .btn{padding:.45rem .7rem;border:1px solid #e6ebf2;background:#fff;border-radius:10px;cursor:pointer}
  .btn:hover{background:#f8fafc}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .cal-dow{background:#f8fafc;border:1px solid #e6ebf2;border-radius:10px;padding:.4rem 0;text-align:center;font-weight:600;color:#555}
  .cal-cell{min-height:110px;border:1px solid #e6ebf2;border-radius:10px;background:#fff;padding:.5rem;display:flex;flex-direction:column}
  .cal-cell.is-today{outline:2px solid var(--accent,#F17300)}
  .cal-date{font-size:.9rem;color:#333;margin-bottom:.35rem}
  .cal-empty{opacity:.35}
  .evt-chip{font-size:.82rem;line-height:1.2;background:#054A910D;border:1px solid #e6ebf2;border-radius:8px;padding:.25rem .35rem;margin:.15rem 0;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .cal-legend{display:flex;gap:.5rem;align-items:center;margin:.75rem 0 0;color:#666;font-size:.9rem}
  .dot{width:10px;height:10px;border-radius:50%;background:#054A91;display:inline-block}
  /* Modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:1rem;z-index:9999}
  .modal.open{display:flex}
  .modal-card{width:min(560px,92vw);background:#fff;border-radius:14px;border:1px solid #e6ebf2;box-shadow:0 8px 30px rgba(0,0,0,.12);overflow:hidden}
  .modal-head{display:flex;align-items:center;justify-content:space-between;padding:1rem 1rem .5rem 1rem;border-bottom:1px solid #eef2f7}
  .modal-title{font-size:1.1rem;margin:0}
  .modal-body{padding:1rem;display:grid;gap:.8rem}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
  label{font-size:.9rem;color:#333}
  input[type="text"],input[type="date"],input[type="time"],textarea,select{
    width:100%;border:1px solid #e6ebf2;border-radius:10px;padding:.55rem .65rem;font:inherit
  }
  textarea{min-height:120px;resize:vertical}
  .modal-foot{display:flex;justify-content:space-between;gap:.5rem;padding:0 1rem 1rem}
  .btn-primary{background:v<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Events — Semitic Jew</title>
<link href="/israelite-research/styles.css" rel="stylesheet"/>
<style>
  /* ===== Scoped calendar styles ===== */
  .events-page .container{max-width:1200px;margin:0 auto;padding:0 16px;}
  .events-page .calendar-wrap{max-width:1000px;margin:0 auto 40px;}

  .events-page .page-header{padding:24px 0 8px;}
  .events-page .page-title{margin:0;font-size:2rem;font-weight:800;}

  .cal-toolbar{display:flex;align-items:center;justify-content:space-between;gap:.75rem;margin:1rem 0 1.25rem}
  .cal-title{font-size:1.25rem;margin:0;font-weight:700}
  .cal-nav{display:flex;gap:.5rem}
  .btn{padding:.45rem .7rem;border:1px solid #e6ebf2;background:#fff;border-radius:10px;cursor:pointer}
  .btn:hover{background:#f8fafc}

  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .cal-dow{background:#f8fafc;border:1px solid #e6ebf2;border-radius:10px;padding:.4rem 0;text-align:center;font-weight:600;color:#555}
  .cal-cell{min-height:110px;border:1px solid #e6ebf2;border-radius:10px;background:#fff;padding:.5rem;display:flex;flex-direction:column}
  .cal-cell.is-today{outline:2px solid var(--accent,#F17300)}
  .cal-date{font-size:.9rem;color:#333;margin-bottom:.35rem}
  .cal-empty{opacity:.35}

  .evt-chip{font-size:.82rem;line-height:1.2;background:#054A910D;border:1px solid #e6ebf2;border-radius:8px;padding:.25rem .35rem;margin:.15rem 0;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  .cal-legend{display:flex;gap:.5rem;align-items:center;margin:.75rem 0 0;color:#666;font-size:.9rem}
  .dot{width:10px;height:10px;border-radius:50%;background:#054A91;display:inline-block}

  /* Modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:1rem;z-index:9999}
  .modal.open{display:flex}
  .modal-card{width:min(640px,92vw);background:#fff;border-radius:14px;border:1px solid #e6ebf2;box-shadow:0 8px 30px rgba(0,0,0,.12);overflow:hidden}
  .modal-head{display:flex;align-items:center;justify-content:space-between;padding:1rem 1rem .5rem;border-bottom:1px solid #eef2f7}
  .modal-title{font-size:1.1rem;margin:0}
  .modal-body{padding:1rem;display:grid;gap:1rem}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
  .form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.75rem}
  @media (max-width:640px){
    .form-row,.form-row-3{grid-template-columns:1fr}
  }
  label{font-size:.9rem;color:#333;display:block;margin-bottom:.25rem}
  input[type="text"],input[type="date"],input[type="time"],textarea,select{
    width:100%;border:1px solid #e6ebf2;border-radius:10px;padding:.55rem .65rem;font:inherit;background:#fff
  }
  textarea{min-height:120px;resize:vertical}
  .muted{color:#6b7280}

  .modal-foot{display:flex;justify-content:space-between;gap:.5rem;padding:0 1rem 1rem}
  .btn-primary{background:var(--accent,#F17300);color:#fff;border-color:transparent}
  .btn-danger{border-color:#ffd8d8;background:#fff;color:#b42318}
  .btn-ghost{background:transparent}
  .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}
</style>
</head>
<body class="events-page">
<div id="site-header"></div>

<main class="container">
  <header class="page-header">
    <h1 class="page-title">Events</h1>
  </header>

  <div class="calendar-wrap">
    <div class="cal-toolbar">
      <div class="cal-nav">
        <button aria-label="Previous month" class="btn" id="prevBtn">‹ Prev</button>
        <button aria-label="Jump to today" class="btn" id="todayBtn">Today</button>
        <button aria-label="Next month" class="btn" id="nextBtn">Next ›</button>
      </div>
      <h2 class="cal-title" id="calTitle">Month YYYY</h2>
      <button class="btn btn-primary" id="addEventBtn">+ Add Event</button>
    </div>

    <div class="cal-grid" id="dowRow">
      <div class="cal-dow">Sun</div><div class="cal-dow">Mon</div><div class="cal-dow">Tue</div>
      <div class="cal-dow">Wed</div><div class="cal-dow">Thu</div><div class="cal-dow">Fri</div><div class="cal-dow">Sat</div>
    </div>
    <div aria-live="polite" class="cal-grid" id="calGrid"></div>

    <div class="cal-legend">
      <span class="dot"></span> Event
    </div>
  </div>
</main>

<div id="site-footer"></div>

<!-- Add/Edit Event Modal -->
<div aria-labelledby="modalTitle" aria-modal="true" class="modal" id="eventModal" role="dialog">
  <div class="modal-card">
    <div class="modal-head">
      <h3 class="modal-title" id="modalTitle">Add Event</h3>
      <button aria-label="Close" class="btn btn-ghost" id="closeModal">✕</button>
    </div>

    <div class="modal-body">
      <!-- Row 1: Native date + time -->
      <div class="form-row">
        <div>
          <label for="evtDate">Date</label>
          <input id="evtDate" type="date"/>
        </div>
        <div>
          <label for="evtTime">Time <span class="muted">(optional)</span></label>
          <input id="evtTime" type="time"/>
        </div>
      </div>

      <!-- Row 2: Month / Day / Year selectors (synced with date) -->
      <div class="form-row-3">
        <div>
          <label for="evtMonthSel">Month</label>
          <select id="evtMonthSel"></select>
        </div>
        <div>
          <label for="evtDaySel">Day</label>
          <select id="evtDaySel"></select>
        </div>
        <div>
          <label for="evtYearSel">Year</label>
          <select id="evtYearSel"></select>
        </div>
      </div>

      <!-- Row 3: Title -->
      <div>
        <label for="evtTitle">Title</label>
        <input id="evtTitle" placeholder="e.g., Bible Study" type="text"/>
      </div>

      <!-- Row 4: Description -->
      <div>
        <label for="evtDesc">Description <span class="muted">(optional)</span></label>
        <textarea id="evtDesc" placeholder="Notes, location, link…"></textarea>
      </div>
    </div>

    <div class="modal-foot">
      <button class="btn btn-danger" id="deleteEvent" style="display:none">Delete</button>
      <div style="margin-left:auto;display:flex;gap:.5rem">
        <button class="btn" id="cancelEvent">Cancel</button>
        <button class="btn btn-primary" id="saveEvent">Save</button>
      </div>
    </div>
  </div>
</div>

<script src="/israelite-research/js/include.js"></script>
<script>
(function(){
  const grid = document.getElementById('calGrid');
  const titleEl = document.getElementById('calTitle');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const todayBtn = document.getElementById('todayBtn');
  const addEventBtn = document.getElementById('addEventBtn');

  const modal = document.getElementById('eventModal');
  const closeModal = document.getElementById('closeModal');
  const cancelEvent = document.getElementById('cancelEvent');
  const saveEvent = document.getElementById('saveEvent');
  const deleteEventBtn = document.getElementById('deleteEvent');

  const evtDate = document.getElementById('evtDate');
  const evtTime = document.getElementById('evtTime');
  const evtTitle = document.getElementById('evtTitle');
  const evtDesc = document.getElementById('evtDesc');

  const monthSel = document.getElementById('evtMonthSel');
  const daySel   = document.getElementById('evtDaySel');
  const yearSel  = document.getElementById('evtYearSel');

  const modalTitle = document.getElementById('modalTitle');

  const STORAGE_KEY = 'ir_events_v1';
  let events = loadEvents();
  let current = new Date();
  let editingId = null;

  function loadEvents(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
    catch(e){ return []; }
  }
  function saveEvents(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
  }

  function startOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
  function endOfMonth(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0); }
  function pad(n){ return String(n).padStart(2,'0'); }
  function fmtDate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }

  function render(){
    const first = startOfMonth(current);
    const last  = endOfMonth(current);
    const startDow = first.getDay();
    const totalDays = last.getDate();

    titleEl.textContent = first.toLocaleString(undefined, {month:'long', year:'numeric'});

    grid.innerHTML = '';
    for(let i=0;i<startDow;i++){
      const cell = document.createElement('div');
      cell.className = 'cal-cell cal-empty';
      grid.appendChild(cell);
    }

    const todayStr = fmtDate(new Date());
    for(let day=1; day<=totalDays; day++){
      const cell = document.createElement('div');
      cell.className = 'cal-cell';
      const dateObj = new Date(current.getFullYear(), current.getMonth(), day);
      const dateStr = fmtDate(dateObj);
      if(dateStr === todayStr) cell.classList.add('is-today');

      const dateEl = document.createElement('div');
      dateEl.className = 'cal-date';
      dateEl.textContent = day;
      cell.appendChild(dateEl);

      const dayEvents = events.filter(e => e.date === dateStr);
      dayEvents.slice(0,3).forEach(e => {
        const chip = document.createElement('div');
        chip.className = 'evt-chip';
        chip.textContent = e.time ? `${e.time} — ${e.title}` : e.title;
        chip.title = e.desc || '';
        chip.addEventListener('click', (ev) => { ev.preventDefault(); openEdit(e); });
        cell.appendChild(chip);
      });
      if(dayEvents.length > 3){
        const more = document.createElement('div');
        more.className = 'evt-chip';
        more.textContent = `+${dayEvents.length-3} more`;
        more.addEventListener('click', (ev)=>{ ev.preventDefault(); openAdd(dateStr); });
        cell.appendChild(more);
      }

      cell.addEventListener('click', (ev)=>{
        if(ev.target.classList.contains('evt-chip')) return;
        openAdd(dateStr);
      });

      grid.appendChild(cell);
    }
  }

  // ----- Month/Day/Year selectors -----
  const MONTH_NAMES = Array.from({length:12},(_,i)=> new Date(2000,i,1).toLocaleString(undefined,{month:'long'}));
  function populateMDY(baseDate){
    // Months
    monthSel.innerHTML = MONTH_NAMES.map((m,i)=>`<option value="${i}">${m}</option>`).join('');
    // Years (±10 years around current year)
    const nowY = (baseDate||new Date()).getFullYear();
    const years = [];
    for(let y=nowY-10; y<=nowY+10; y++) years.push(`<option value="${y}">${y}</option>`);
    yearSel.innerHTML = years.join('');

    const d = baseDate || new Date();
    monthSel.value = String(d.getMonth());
    yearSel.value  = String(d.getFullYear());
    populateDays(d.getFullYear(), d.getMonth(), d.getDate());
  }
  function populateDays(year, month, selectedDay){
    const last = new Date(year, month+1, 0).getDate();
    let opts = '';
    for(let d=1; d<=last; d++){
      opts += `<option value="${d}" ${d===selectedDay?'selected':''}>${d}</option>`;
    }
    daySel.innerHTML = opts;
  }
  function syncDateInputFromMDY(){
    const y = parseInt(yearSel.value,10);
    const m = parseInt(monthSel.value,10);
    const d = parseInt(daySel.value,10);
    const dt = new Date(y, m, Math.min(d, new Date(y,m+1,0).getDate()));
    evtDate.value = fmtDate(dt);
    // ensure day valid if month/year change
    populateDays(y, m, dt.getDate());
    daySel.value = String(dt.getDate());
  }
  function syncMDYFromDateInput(){
    if(!evtDate.value) return;
    const [Y,M,D] = evtDate.value.split('-').map(n=>parseInt(n,10));
    yearSel.value = String(Y);
    monthSel.value = String(M-1);
    populateDays(Y, M-1, D);
  }

  // ----- Modal open/close + CRUD -----
  function openAdd(dateStr){
    editingId = null;
    modalTitle.textContent = 'Add Event';
    if(dateStr){
      evtDate.value = dateStr;
    }else{
      evtDate.value = fmtDate(new Date());
    }
    evtTime.value = '';
    evtTitle.value = '';
    evtDesc.value = '';
    deleteEventBtn.style.display = 'none';
    // set MDY to match date
    syncMDYFromDateInput();
    modal.classList.add('open');
    evtTitle.focus();
  }

  function openEdit(e){
    editingId = e.id;
    modalTitle.textContent = 'Edit Event';
    evtDate.value = e.date;
    evtTime.value = e.time || '';
    evtTitle.value = e.title || '';
    evtDesc.value = e.desc || '';
    deleteEventBtn.style.display = 'inline-block';
    syncMDYFromDateInput();
    modal.classList.add('open');
    evtTitle.focus();
  }

  function close(){
    modal.classList.remove('open');
  }

  function onSave(){
    const date = evtDate.value;
    const title = evtTitle.value.trim();
    const time = evtTime.value.trim();
    const desc = evtDesc.value.trim();
    if(!date || !title){ alert('Please provide a date and title.'); return; }

    if(editingId){
      const idx = events.findIndex(x => x.id === editingId);
      if(idx >= 0){ events[idx] = { ...events[idx], date, title, time, desc }; }
    }else{
      const id = 'evt_' + Math.random().toString(36).slice(2,9);
      events.push({ id, date, title, time, desc });
    }
    saveEvents(); close(); render();
  }

  function onDelete(){
    if(!editingId) return;
    events = events.filter(x => x.id !== editingId);
    saveEvents(); close(); render();
  }

  // Nav
  prevBtn.addEventListener('click', ()=>{ current.setMonth(current.getMonth()-1); render(); });
  nextBtn.addEventListener('click', ()=>{ current.setMonth(current.getMonth()+1); render(); });
  todayBtn.addEventListener('click', ()=>{ current = new Date(); render(); });
  addEventBtn.addEventListener('click', ()=> openAdd(fmtDate(new Date())));

  // Modal control
  closeModal.addEventListener('click', close);
  cancelEvent.addEventListener('click', close);
  deleteEventBtn.addEventListener('click', onDelete);
  saveEvent.addEventListener('click', onSave);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) close(); });

  // Sync MDY <-> date input
  evtDate.addEventListener('change', syncMDYFromDateInput);
  monthSel.addEventListener('change', ()=>{ syncDateInputFromMDY(); });
  yearSel.addEventListener('change',  ()=>{ syncDateInputFromMDY(); });
  daySel.addEventListener('change',   ()=>{ syncDateInputFromMDY(); });

  // Init
  populateMDY(new Date());
  render();
})();
</script>
</html>
