#!/usr/bin/env python3
import os, json

ROOT = "data"
OUT = "tools/verse_counts/chapter_counts.json"

def main():
    counts = {}
    for fam in ("tanakh","newtestament","apocrypha"):
        fam_dir = os.path.join(ROOT, fam)
        if not os.path.isdir(fam_dir): 
            continue
        for book_slug in os.listdir(fam_dir):
            bdir = os.path.join(fam_dir, book_slug)
            if not os.path.isdir(bdir): 
                continue
            chs = [fn for fn in os.listdir(bdir) if fn.endswith(".json")]
            nums = []
            for fn in chs:
                try:
                    n = int(os.path.splitext(fn)[0])
                    nums.append(n)
                except:
                    pass
            if nums:
                counts[f"{fam}/{book_slug}"] = max(nums)
    os.makedirs(os.path.dirname(OUT), exist_ok=True)
    with open(OUT, "w", encoding="utf-8") as f:
        json.dump(counts, f, ensure_ascii=False, indent=2)
    print(f"Wrote {OUT}")

if __name__ == "__main__":
    main()
