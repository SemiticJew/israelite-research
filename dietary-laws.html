<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Dietary Laws — Semitic Jew</title>
<link href="/israelite-research/styles.css" rel="stylesheet"/>
<style>
  :root{--ink:#0b2340;--accent:#F17300;--brand:#054A91;--muted:#6b7280;--sky:#DBE4EE;--white:#fff;--brand2:#3E7CB1;--brand3:#81A4CD}
  .container{max-width:1200px;margin:0 auto;padding:0 16px}
  .page-header{padding:24px 0 8px}
  .page-title{margin:0;font-size:2rem;font-weight:800;color:var(--ink)}
  .breadcrumb{color:var(--muted);font-size:.9rem;margin-top:6px}

  /* Search bar */
  .searchbar{
    display:flex; gap:.5rem; align-items:center;
    background:var(--white); border:1px solid var(--sky); border-radius:10px;
    padding:.5rem; margin:12px 0 10px;
  }
  .searchbar input[type="search"]{
    flex:1; border:1px solid #e6ebf2; border-radius:10px; padding:.55rem .7rem; font:inherit;
  }
  .searchbar .btn{
    border:1px solid #e6ebf2; background:#fff; border-radius:10px; padding:.5rem .8rem; cursor:pointer; font:inherit;
  }
  .searchbar .btn:hover{ background:#f8fafc }

  /* Tree */
  .tree{margin:14px 0 36px}
  .tree details{border:1px solid var(--sky); background:var(--white); margin:8px 0; border-radius:10px; padding:8px 10px}
  .tree details[open]{box-shadow:0 4px 10px rgba(0,0,0,.06)}
  .tree .group{margin:8px 0 0 0; padding:0}
  .tree .group details{margin:6px 0}
  .tree .leaf{list-style:none; margin:4px 0; display:flex; align-items:center; gap:.5rem}
  .law-link{color:var(--brand); text-decoration:none; border-bottom:1px solid transparent}
  .law-link:hover{border-bottom-color:var(--brand)}

  .tag{display:inline-block; font-size:.78rem; color:#333; background:#054A910D; border:1px solid var(--sky); border-radius:8px; padding:.05rem .35rem}
  .note{color:var(--muted); font-size:.85rem; margin-top:.35rem}

  /* Highlight */
  .hl{ background:#fff3c4; box-shadow:0 0 0 2px #fde68a inset; }

  /* Hidden during filter */
  .hide{ display:none !important; }

  /* Chevron style */
  .tree summary::-webkit-details-marker { display: none; }
  .tree summary { list-style: none; }
  .tree summary {
    padding: .4rem .6rem .4rem 1.5rem;
    border-radius: 8px;
    position: relative;
    cursor: pointer;
    font-weight: 800;
    color: var(--brand);
    transition: background .2s;
  }
  .tree summary:hover { background: #f8fafc; }
  .tree summary::before {
    content: "";
    border: solid var(--accent);
    border-width: 0 .15em .15em 0;
    display: inline-block;
    padding: .25em;
    position: absolute;
    left: .5rem;
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
    transition: transform .2s;
  }
  .tree details[open] > summary::before {
    transform: translateY(-50%) rotate(135deg);
  }

  /* Brand SVG icons */
  .ico{
    width: 18px; height: 18px; vertical-align: -3px;
    margin-right: .45rem; color: var(--brand);
    flex: 0 0 18px;
  }
  .ico path, .ico circle, .ico rect, .ico polygon, .ico line { fill: currentColor; stroke: currentColor; }
  .tree summary .sumline{ display:inline-flex; align-items:center; gap:.45rem; }

  /* --- Example cards: Header / Middle / Footer --- */
  .example-cards {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
  .example-card {
  background: #fff;
  border: 1px solid var(--sky);
  border-radius: 10px;
  padding: 6px 8px;
  font-size: 0.85rem;
  box-shadow: 0 1px 2px rgba(0,0,0,.04);
}
.example-card .card-head {
  padding: 4px 6px;
  border-radius: 6px 6px 0 0;
  font-size: 0.8rem;
  font-weight: 700;
  color: #fff;
}

/* Status-based colors */
.example-card.forbidden .card-head   { background: #F17300; }
.example-card.prohibited .card-head  { background: #000; }
.example-card.avoid .card-head       { background: #81A4CD; }
.example-card.verify .card-head      { background: #3E7CB1; }
.example-card.allowed .card-head     { background: #054A91; }

.example-card .card-head {
  font-size: 0.8rem;
  padding: 2px 4px;
}
.example-card .card-title {
  font-size: 0.9rem;
  font-weight: 600;
}
.example-card .card-foot {
  font-size: 0.75rem;
  color: var(--muted);
}

  .example-card .card-head{
    font-weight: 800;
    padding: 6px 10px;
    letter-spacing: .2px;
  }
  .example-card .card-title{
    padding: 10px 12px 2px 12px;
    font-weight: 800;
    color: var(--ink);
  }
  .example-card .card-foot{
    padding: 0 12px 10px 12px;
    font-size: .9rem;
    color: var(--muted);
  }

  /* Status colors (header) */
  .example-card.allowed   .card-head{ background:#054A91; color:#fff; }
  .example-card.forbidden .card-head{ background:#F17300; color:#fff; }
  .example-card.prohibited .card-head{ background:#F17300; color:#fff; }
  .example-card.avoid     .card-head{ background:#3E7CB1; color:#fff; }
  .example-card.verify    .card-head{ background:#81A4CD; color:#0b2340; }
/* Search My Food (tool shell) */
.foodcheck-wrap textarea{
  width:100%; border:1px solid var(--sky); border-radius:10px; padding:.8rem; font:inherit; resize:vertical;
}
.fc-actions{ display:flex; align-items:center; gap:.6rem; margin-top:.5rem; }
#foodCheckBtn{
  border:1px solid var(--sky); background:#fff; border-radius:10px; padding:.5rem .9rem; cursor:pointer; font:inherit;
}
#foodCheckBtn:hover{ background:#f8fafc; }
.fc-hint{ color:var(--muted); }

/* Verdict banner */
.fc-banner{ margin:12px 0; padding:.6rem .8rem; border-radius:10px; font-weight:800; }
.fc-banner.allowed   { background:#054A9111; color:#054A91; border:1px solid var(--sky); }
.fc-banner.verify    { background:#81A4CD22; color:#0b2340; border:1px solid var(--sky); }
.fc-banner.avoid     { background:#3E7CB122; color:#0b2340; border:1px solid var(--sky); }
.fc-banner.forbidden,
.fc-banner.prohibited{ background:#F1730015; color:#F17300; border:1px solid var(--sky); }

/* Suggestions */
.fc-suggest{ margin:10px 0; border:1px solid var(--sky); border-radius:10px; overflow:hidden; }
.fc-suggest button{
  display:block; width:100%; text-align:left; padding:.5rem .8rem; background:#fff; border:0; border-bottom:1px solid var(--sky); cursor:pointer;
}
.fc-suggest button:last-child{ border-bottom:0; }
.fc-suggest button:hover{ background:#f8fafc; }

/* Nutrition mini card */
.nutri-card.example-card .card-head{ background:#054A91; color:#fff; }
.nutri-lines{ padding:6px 12px 10px 12px; font-size:.9rem; color:var(--ink); }
.nutri-lines div{ display:flex; justify-content:space-between; }
.nutri-lines small{ color:var(--muted); }

</style>
</head>
<body>
<div id="site-header"></div>

<main class="container">
  <!-- Search / Filter -->
  <div class="searchbar" role="search">
    <input aria-label="Search dietary items" id="dietSearch" placeholder="Search animals, fish, birds, or ingredients (e.g., pig, salmon, blood, gelatin, oyster sauce, carmine)…" type="search"/>
    <button class="btn" id="dietClear" type="button">Clear</button>
  </div>
<section id="foodCheck" aria-label="Search My Food" style="margin:18px 0 28px">
  <div class="foodcheck-wrap">
    <label for="foodText" class="sr-only">Paste ingredients or type a product</label>
    <textarea id="foodText" rows="3" placeholder="Paste ingredients (e.g., sugar, gelatin, natural flavors, carmine/E120) or type a product (e.g., Hummus, commercial)…"></textarea>
    <div class="fc-actions">
      <button id="foodCheckBtn" type="button">Check</button>
      <small class="fc-hint">We’ll flag Forbidden, Avoid, Verify, or Allowed — and show why.</small>
    </div>

    <div id="foodSuggestions" class="fc-suggest" hidden></div>
    <div id="foodVerdict" class="fc-banner" hidden></div>
    <div id="foodResults" class="example-cards" aria-live="polite"></div>
  </div>
</section>

  <section aria-label="Collapsible tree of dietary laws" class="tree" id="dietTree"></section>

  <p class="note">
    <strong>Note:</strong> “Modern examples” are practical guides based on biblical categories (e.g., fins &amp; scales; cloven hoof &amp; chewing cud; blood). Verify ingredients/sourcing (e.g., enzyme origin, gelatin type, shellfish derivatives) and preparation (blood removal per Lev 17).
  </p>
</main>

<div id="site-footer"></div>

<script src="/israelite-research/js/include.js"></script>

<script>
  // --- Book slug map for links (extend anytime) ---
  const BOOK_SLUG = {
    "Genesis":"genesis","Exodus":"exodus","Leviticus":"leviticus","Numbers":"numbers","Deuteronomy":"deuteronomy",
    "Matthew":"matthew","Mark":"mark","Luke":"luke","John":"john","Acts":"acts","Romans":"romans"
  };

  function parseRef(ref){
    const m = String(ref).trim().match(/^([1-3]?\s?[A-Za-z]+)\s+(\d+):(\d+)$/);
    if(!m) return null;
    const bookName = m[1].replace(/\s+/g," ").trim();
    const ch = parseInt(m[2],10), v = parseInt(m[3],10);
    const base = bookName.replace(/^1\s|^2\s|^3\s/,'');
    const slug = BOOK_SLUG[base] || BOOK_SLUG[bookName] || base.toLowerCase();
    return { book:bookName, ch, v, slug };
  }
  function refHref(ref){
    const p = parseRef(ref); if(!p) return '#';
    const canon = (["Genesis","Exodus","Leviticus","Numbers","Deuteronomy"].includes(p.book) ? "tanakh" : "newtestament");
    return `/israelite-research/${canon}/chapter.html?book=${encodeURIComponent(p.slug)}&ch=${p.ch}#v${p.v}`;
  }

  /* ======================= DATA (labels without emojis) ======================= */
  const DATA = {
    "Clean": {
      "Mammals": {
        refs: ["Leviticus 11:3", "Deuteronomy 14:4", "Deuteronomy 14:6"],
        examples: [
          {name:"Cattle (beef)", why:"cloven hoof, chews cud"},
          {name:"Sheep (lamb/mutton)", why:"cloven hoof, chews cud"},
          {name:"Goat (chevon)", why:"cloven hoof, chews cud"},
          {name:"Deer/Antelope", why:"clean wild species (Deut 14:5)"}
        ]
      },
      "Fish (fins & scales)": {
        refs: ["Leviticus 11:9", "Deuteronomy 14:9"],
        examples: [
          {name:"Salmon, Trout, Char"},
          {name:"Cod, Haddock, Pollock"},
          {name:"Sardine, Anchovy, Mackerel"},
          {name:"Carp, Tilapia"},
          {name:"Tuna*", why:"scales debate by species—verify", status:"verify"}
        ]
      },
      "Birds (general allowance)": {
        refs: ["Deuteronomy 14:11"],
        examples: [
          {name:"Chicken"},
          {name:"Turkey"},
          {name:"Goose* / Duck*", why:"accepted by many; verify local tradition", status:"verify"},
          {name:"Dove / Pigeon", why:"used for offerings"},
          {name:"Quail"}
        ]
      }
    },

    "Unclean": {
      "Mammals (do not meet both signs)": {
        refs: ["Leviticus 11:4", "Leviticus 11:7", "Leviticus 11:8", "Deuteronomy 14:7", "Deuteronomy 14:8"],
        examples: [
          {name:"Pig (pork)", why:"split hoof but does not chew cud"},
          {name:"Camel", why:"chews cud but no split hoof"},
          {name:"Hare / Rabbit", why:"chews cud (appearance) but no split hoof"},
          {name:"Rock badger (hyrax)", why:"chews cud (appearance) but no split hoof"}
        ]
      },
      "Aquatic (no fins & scales)": {
        refs: ["Leviticus 11:10"],
        examples: [
          {name:"Shrimp, Prawn", why:"No fins & scales"},
          {name:"Crab, Lobster", why:"No fins & scales"},
          {name:"Oyster, Clam, Mussel, Scallop", why:"No fins & scales"},
          {name:"Squid, Octopus", why:"No fins & scales"},
          {name:"Eel, Catfish*", why:"scales absent/non-removable"}
        ]
      },
      "Birds (forbidden list patterns)": {
        refs: ["Leviticus 11:13", "Leviticus 11:19", "Deuteronomy 14:12", "Deuteronomy 14:18"],
        examples: [
          {name:"Birds of prey", why:"eagle, hawk, falcon, kite, osprey"},
          {name:"Carrion/seabirds", why:"vulture, raven, cormorant, pelican"},
          {name:"Owls & night birds"},
          {name:"Stork, Heron"},
          {name:"Bat", why:"explicitly forbidden"}
        ]
      },
      "Insects": {
        refs: ["Leviticus 11:20", "Leviticus 11:23"],
        examples: [
          {name:"Most winged creeping things", why:"unclean"},
          {name:"Locust/Grasshopper families", why:"specific kinds permitted (Lev 11:22) if identified correctly", status:"verify"}
        ]
      }
    },

    "Prohibited Practices": {
      "Blood": {
        refs: ["Leviticus 17:10", "Leviticus 17:12", "Leviticus 17:14"],
        examples: [
          {name:"Blood dishes (e.g., blood sausage/black pudding)", why:"forbidden"},
          {name:"Undrained meat", why:"drain & salt to remove blood"}
        ]
      },
      "Carcasses / torn animals": {
        refs: ["Leviticus 11:39", "Leviticus 11:40", "Exodus 22:31", "Leviticus 17:15"],
        examples: [
          {name:"Animals dead of themselves", why:"do not eat"},
          {name:"Torn by beasts", why:"do not eat"}
        ]
      },
      "Certain fats (ox/sheep/goat)": {
        refs: ["Leviticus 7:23", "Leviticus 7:25"],
        examples: [
          {name:"Suet/fat reserved from these animals", why:"do not eat"}
        ]
      }
    },

    "Everyday Foods & Hidden Ingredients (Check Labels)": {
      "Pork-derived (avoid)": {
        refs: ["Leviticus 11:7", "Deuteronomy 14:8"],
        examples: [
          {name:"Gelatin (porcine)", why:"used in gummies, marshmallows, capsules", status:"avoid"},
          {name:"Lard / Pork fat", why:"baked goods, refried beans, pie crusts", status:"avoid"},
          {name:"Mono-/Diglycerides (animal)", why:"E471/E472—origin may be pork; verify plant vs animal", status:"verify"},
          {name:"Pepsin/Lipase (animal)", why:"enzymes in some cheeses; verify microbial/vegetable", status:"verify"},
          {name:"‘Natural flavors’ (meat-derived)", why:"can include pork stock/essence—ask vendor", status:"verify"}
        ]
      },
      "Shellfish-derived (avoid)": {
        refs: ["Leviticus 11:10"],
        examples: [
          {name:"Oyster sauce", why:"common in stir-fry sauces", status:"avoid"},
          {name:"Shrimp paste", why:"used in SE Asian condiments/curries", status:"avoid"},
          {name:"Imitation crab (surimi)", why:"often contains shellfish", status:"avoid"},
          {name:"Fish/seafood stock blends", why:"may include shellfish extracts", status:"avoid"},
          {name:"Krill oil supplements", why:"crustacean-derived", status:"avoid"}
        ]
      },
      "Insect-derived (avoid except permitted locust kinds)": {
        refs: ["Leviticus 11:20", "Leviticus 11:23"],
        examples: [
          {name:"Carmine/Cochineal (E120)", why:"red color in drinks/candies/yogurts", status:"avoid"},
          {name:"Shellac/Confectioner’s glaze (E904)", why:"candy/produce coating", status:"avoid"},
          {name:"Insect protein flours", why:"marketed as sustainable protein", status:"avoid"}
        ]
      },
      "Cheese & Enzymes (verify source)": {
        refs: ["Leviticus 11 (category context)"],
        examples: [
          {name:"Animal rennet cheeses", why:"use microbial/vegetable rennet instead", status:"verify"},
          {name:"Lipase (animal)", why:"used for flavor development—seek microbial", status:"verify"},
          {name:"‘Parmesan’ style", why:"often animal rennet; check label or brand policy", status:"verify"}
        ]
      },
      "Stocks, Broths, Flavorings (avoid if unclean)": {
        refs: ["Leviticus 11 (category context)"],
        examples: [
          {name:"Pork broth / ham flavor", why:"soups, legumes, greens", status:"avoid"},
          {name:"Mixed ‘meat flavor’ packets", why:"can blend multiple animal bases", status:"avoid"},
          {name:"Ramen flavor bases", why:"may include pork or shellfish", status:"avoid"}
        ]
      },
      "Confectionery & Capsules (verify gelatin source)": {
        refs: ["Leviticus 11:7-8 (category context)"],
        examples: [
          {name:"Marshmallows/Gummies", why:"often porcine gelatin—look for fish/plant gelatin", status:"verify"},
          {name:"Vitamin/med capsules", why:"ask for fish/plant-based or HPMC capsules", status:"verify"},
          {name:"Desserts with ‘stabilizers’", why:"may include gelatin—confirm origin", status:"verify"}
        ]
      }
    }
  };

  /* ======================= Icon helpers ======================= */
  function iconCow(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 8h2l2-2h8l2 2h2v3h-2v5a2 2 0 0 1-2 2h-1v-3h-2v3H8a2 2 0 0 1-2-2v-5H4V8z"/></svg>'; }
  function iconFish(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12s3-5 9-5c5 0 9 5 9 5s-4 5-9 5c-6 0-9-5-9-5zm13 0a2 2 0 1 0 0-0.01z"/></svg>'; }
  function iconBird(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12l6-2 3-6 3 6 6 2-6 2-3 6-3-6-6-2z"/></svg>'; }
  function iconBug(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 8h10a4 4 0 0 1 4 4v2H3v-2a4 4 0 0 1 4-4zm5-5l3 3H9l3-3zM4 14v3h3v-3H4zm13 0v3h3v-3h-3z"/></svg>'; }
  function iconDrop(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2s6 7 6 11a6 6 0 0 1-12 0c0-4 6-11 6-11z"/></svg>'; }
  function iconWarn(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3l10 18H2L12 3zm0 5l-1 7h2l-1-7zm0 9a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>'; }
  function iconCheese(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10l9-5 9 5v8H3v-8zm5 4a2 2 0 1 0 0-.01zM15 14a1 1 0 1 0 0-.01z"/></svg>'; }
  function iconPot(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 9h16v8a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V9zm-2-2h20v2H2V7z"/></svg>'; }
  function iconCandy(){ return '<svg class="ico" viewBox="0 0 24 24" aria-hidden="true"><path d="M9 9h6v6H9zM5 7l2 2-2 2-2-2 2-2zm14 0l2 2-2 2-2-2 2-2zm-14 8l2 2-2 2-2-2 2-2zm14 0l2 2-2 2-2-2 2-2z"/></svg>'; }

  function iconFor(label){
    const L = label.toLowerCase();
    if (L.startsWith('mammals')) return iconCow();
    if (L.startsWith('fish') || L.startsWith('aquatic')) return iconFish();
    if (L.startsWith('birds')) return iconBird();
    if (L.startsWith('insects')) return iconBug();
    if (L === 'blood') return iconDrop();
    if (L.startsWith('carcasses')) return iconWarn();
    if (L.startsWith('certain fats')) return iconDrop();
    if (L.startsWith('cheese')) return iconCheese();
    if (L.startsWith('stocks') || L.startsWith('broths') || L.startsWith('flavorings')) return iconPot();
    if (L.startsWith('confectionery') || L.includes('capsules')) return iconCandy();
    if (L.startsWith('pork-derived')) return iconWarn();
    if (L.startsWith('shellfish')) return iconFish();
    if (L.startsWith('insect-derived')) return iconBug();
    return iconWarn(); // default fallback
  }

  /* ======================= Render & Search ======================= */
  const tree = document.getElementById('dietTree');

  function renderTree(){
    const frag = document.createDocumentFragment();

    Object.entries(DATA).forEach(([section, groups]) => {
      const sec = document.createElement('details');
      sec.open = true;
      sec.className = 'sec';
      const sum = document.createElement('summary');
      sum.innerHTML = `<span class="sumline">${section}</span>`;
      sec.appendChild(sum);

      const wrap = document.createElement('div');
      wrap.className = 'group';

      Object.entries(groups).forEach(([label, payload]) => {
        const grp = document.createElement('details');
        grp.className = 'grp';

        const gsum = document.createElement('summary');
        let refs = [], examples = [];
        if (Array.isArray(payload)) refs = payload;
        else if (payload && typeof payload === 'object') {
          refs = Array.isArray(payload.refs) ? payload.refs : [];
          examples = Array.isArray(payload.examples) ? payload.examples : [];
        }
        const icon = iconFor(label);
        gsum.innerHTML = `<span class="sumline">${icon}${label}</span> <span class="tag">${refs.length} refs</span>${examples.length ? ' <span class="tag">'+examples.length+' examples</span>' : ''}`;
        grp.appendChild(gsum);

        // Refs list
        if (refs.length) {
          const ul = document.createElement('ul');
          ul.style.margin = '6px 0 0 18px'; ul.style.padding = '0';
          refs.forEach(r => {
            const li = document.createElement('li'); li.className = 'leaf';
            const a = document.createElement('a');
            a.className = 'law-link xref-trigger';
            a.dataset.ref = r;
            a.href = refHref(r);
            a.textContent = r;
            a.setAttribute('data-xref', r); // for hover script
            a.dataset.search = `ref ${r.toLowerCase()} ${label.toLowerCase()} ${section.toLowerCase()}`;
            li.appendChild(a);
            ul.appendChild(li);
          });
          grp.appendChild(ul);
        }

        // === Examples renderer: Cards with Header/Middle/Footer ===
        if (examples.length) {
          const grid = document.createElement('div');
          grid.className = 'example-cards';

          // Split "Shrimp, Prawn" or "Goose* / Duck*"
          const splitNames = (s) =>
            String(s || '')
              .split(/[,/]/)
              .map(t => t.trim())
              .filter(Boolean);

          // Decide status class/text
          function computeStatus(sectionLabel, groupLabel, ex) {
            const explicit = (ex.status || '').toLowerCase().trim();
            if (explicit) {
              const textMap = { allowed:'Allowed', forbidden:'Forbidden', avoid:'Avoid', verify:'Verify Source', prohibited:'Prohibited' };
              return { cls: explicit, text: textMap[explicit] || explicit.charAt(0).toUpperCase()+explicit.slice(1) };
            }
            const sec = (sectionLabel || '').toLowerCase();
            if (sec === 'clean') return { cls: 'allowed', text: 'Allowed' };
            if (sec === 'unclean') return { cls: 'forbidden', text: 'Forbidden' };
            if (sec.startsWith('prohibited')) return { cls: 'prohibited', text: 'Prohibited' };

            const lbl = (groupLabel || '').toLowerCase();
            if (lbl.includes('verify')) return { cls: 'verify', text: 'Verify Source' };
            if (lbl.includes('avoid'))  return { cls: 'avoid',  text: 'Avoid' };

            const why = (ex.why || '').toLowerCase();
            if (/\b(verify|check|confirm|ask)\b/.test(why)) return { cls: 'verify', text: 'Verify Source' };
            return { cls: 'avoid', text: 'Avoid' };
          }

          examples.forEach(ex => {
            const names = splitNames(ex.name);
            const why   = ex.why || '';

            const { cls, text } = computeStatus(section, label, ex);

            names.forEach(n => {
              const card = document.createElement('div');
              card.className = `example-card ${cls}`;
              card.innerHTML = `
                <div class="card-head" aria-label="Status: ${text}">${text}</div>
                <div class="card-title">${n}</div>
                ${why ? `<div class="card-foot">${why}</div>` : ``}
              `;
              card.dataset.search = `${n.toLowerCase()} ${why.toLowerCase()} ${label.toLowerCase()} ${section.toLowerCase()} ${text.toLowerCase()}`;
              grid.appendChild(card);
            });
          });

          grp.appendChild(grid);
        }

        grp.dataset.search = `${label.toLowerCase()} ${section.toLowerCase()}`;
        wrap.appendChild(grp);
      });

      sec.appendChild(wrap);
      frag.appendChild(sec);
    });

    tree.innerHTML = '';
    tree.appendChild(frag);
  }

  function debounce(fn, ms){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); }; }

  function applyFilter(q){
    const query = (q||'').trim().toLowerCase();
    const groups = Array.from(tree.querySelectorAll('.grp'));
    const sections = Array.from(tree.querySelectorAll('.sec'));

    // reset
    tree.querySelectorAll('.hl').forEach(el => el.classList.remove('hl'));
    groups.forEach(g => { g.classList.remove('hide'); g.open = false; });
    sections.forEach(s => { s.classList.remove('hide'); s.open = true; });

    if (!query) return;

    groups.forEach(grp => {
      const links = Array.from(grp.querySelectorAll('.law-link'));
      const cards = Array.from(grp.querySelectorAll('.example-card'));

      let anyMatch = false;

      cards.forEach(cd => {
        const hay = (cd.dataset.search || cd.textContent || '').toLowerCase();
        const match = hay.includes(query);
        cd.classList.toggle('hl', match);
        if (match) anyMatch = true;
      });

      links.forEach(a => {
        const hay = (a.dataset.search || a.textContent || '').toLowerCase();
        const match = hay.includes(query);
        a.classList.toggle('hl', match);
        if (match) anyMatch = true;
      });

      if (!anyMatch) {
        const hay = (grp.dataset.search || '').toLowerCase();
        anyMatch = hay.includes(query);
      }

      grp.classList.toggle('hide', !anyMatch);
      grp.open = anyMatch;
    });

    sections.forEach(sec => {
      const visible = sec.querySelector('.grp:not(.hide)');
      sec.classList.toggle('hide', !visible);
      sec.open = !!visible;
    });
  }

  // Bootstrap render + search
  renderTree();
  document.addEventListener('DOMContentLoaded', () => {
    if (window.XRef && typeof window.XRef.scan === "function") {
      window.XRef.scan(document);
    } else {
      document.dispatchEvent(new CustomEvent("xref:refresh"));
    }
  });

  const search = document.getElementById('dietSearch');
  const clearBtn = document.getElementById('dietClear');
  const doFilter = debounce(applyFilter, 120);
  search.addEventListener('input', e => doFilter(e.target.value));
  clearBtn.addEventListener('click', () => { search.value=''; applyFilter(''); search.focus(); });

// ====== Search My Food configuration (data paths) ======
const DICT_URL = '/israelite-research/data/dictionaries/dictionary.json';
const FOODS_URL = '/israelite-research/data/dictionaries/foundation_foods.json';

</script>

<!-- Use the same Scripture hover as articles -->
<script src="/israelite-research/js/citations.js" defer></script>
<script src="/israelite-research/js/xref-hover.js" defer></script>

</body>
</html>
// ====== Search My Food configuration (data paths) ======
const DICT_URL = '/israelite-research/data/dictionaries/dictionary.json';
const FOODS_URL = '/israelite-research/data/dictionaries/foundation_foods.json';
// ====== Search My Food configuration (data paths) ======
if (typeof DICT_URL === 'undefined') { var DICT_URL = '/israelite-research/data/dictionaries/dictionary.json'; }
if (typeof FOODS_URL === 'undefined') { var FOODS_URL = '/israelite-research/data/dictionaries/foundation_foods.json'; }
<script>
// ======= Search My Food: minimal implementation =======
const PRECEDENCE = ['forbidden','prohibited','avoid','verify','allowed'];
let _DICT=null, _FOODS=null;

async function loadJSON(u){ const r=await fetch(u,{cache:'no-store'}); if(!r.ok) throw new Error('Load failed '+u); return r.json(); }
async function loadDictionary(){
  if(_DICT) return _DICT;
  const raw = await loadJSON(DICT_URL);
  const map = new Map(), alias = new Map();
  (raw.entries||[]).forEach(e=>{
    const k=(e.term||'').toLowerCase().trim(); if(!k) return;
    map.set(k,{status:e.status,reason:e.reason,display:e.display||e.term});
    (e.aliases||[]).forEach(a=>alias.set(String(a).toLowerCase(),k));
    (e.enumbers||[]).forEach(code=>alias.set(String(code).toLowerCase(),k));
  });
  _DICT={map,alias}; return _DICT;
}
function tokenize(text){
  const t=String(text||'').toLowerCase();
  const en=Array.from(t.matchAll(/\b(e\d{3}[a-z]?)\b/gi)).map(m=>m[1].toLowerCase());
  const parts=t.replace(/[()]/g,' ').split(/[,;|/]+/).map(s=>s.trim()).filter(Boolean);
  return {parts,enumbers:en};
}
function matchTokens(tokens,dict){
  const hits=[], seen=new Set();
  function add(key,disp,status,reason){ const sig=key+'|'+status; if(seen.has(sig))return; seen.add(sig); hits.push({term:disp,status:status.toLowerCase(),reason:reason||''}); }
  tokens.parts.concat(tokens.enumbers).forEach(tok=>{
    const t=tok.toLowerCase();
    const main = dict.map.has(t) ? t : (dict.alias.get(t)||null);
    if(main){ const e=dict.map.get(main); add(main,e.display||tok,e.status,e.reason); }
  });
  return hits;
}
function verdict(hits){
  if(!hits.length) return {cls:'allowed',text:'No issues found (based on current dictionary)'};
  const best=hits.map(h=>h.status).sort((a,b)=>PRECEDENCE.indexOf(a)-PRECEDENCE.indexOf(b))[0];
  const m={allowed:'Allowed',verify:'Verify',avoid:'Avoid',forbidden:'Forbidden',prohibited:'Prohibited'};
  return {cls:best,text:m[best]||best};
}
function renderCard(hit, extra=''){
  const m={allowed:'Allowed',verify:'Verify Source',avoid:'Avoid',forbidden:'Forbidden',prohibited:'Prohibited'};
  const head=m[hit.status]||hit.status;
  const div=document.createElement('div');
  div.className=`example-card ${hit.status} ${extra}`.trim();
  div.innerHTML=`
    <div class="card-head" aria-label="Status: ${head}">${head}</div>
    <div class="card-title">${hit.term}</div>
    ${hit.reason?`<div class="card-foot">${hit.reason}</div>`:''}
  `;
  return div;
}
(function initFoodTool(){
  const ta=document.getElementById('foodText');
  const btn=document.getElementById('foodCheckBtn');
  const res=document.getElementById('foodResults');
  const ban=document.getElementById('foodVerdict');
  if(!ta||!btn||!res||!ban) return;

  function setBanner(cls,msg){ ban.className=`fc-banner ${cls}`; ban.textContent=msg; ban.hidden=false; }

  btn.addEventListener('click', async ()=>{
    res.innerHTML=''; ban.hidden=true;
    let dict; try{ dict=await loadDictionary(); }catch(e){ setBanner('forbidden','Dictionary failed to load.'); return; }
    const tokens=tokenize(ta.value);
    const hits=matchTokens(tokens,dict);
    const v=verdict(hits);
    setBanner(v.cls,v.text);
    const seen=new Set();
    hits.forEach(h=>{ const sig=h.term+'|'+h.status; if(seen.has(sig))return; seen.add(sig); res.appendChild(renderCard(h)); });
    if(!hits.length){ res.appendChild(renderCard({status:'allowed',term:'No flags from dictionary',reason:'No Forbidden/Avoid/Verify matches found.'})); }
  });
})();
</script>
// ====== Search My Food configuration (data paths) ======
if (typeof DICT_URL === 'undefined') { var DICT_URL = '/israelite-research/data/dictionaries/dictionary.json'; }
if (typeof FOODS_URL === 'undefined') { var FOODS_URL = '/israelite-research/data/dictionaries/foundation_foods.json'; }
// ====== Search My Food configuration (data paths) ======
if (typeof DICT_URL === 'undefined') { var DICT_URL = '/israelite-research/data/dictionaries/dictionary.json'; }
if (typeof FOODS_URL === 'undefined') { var FOODS_URL = '/israelite-research/data/dictionaries/foundation_foods.json'; }
