<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tanakh — Book</title>
  <link rel="stylesheet" href="/israelite-research/styles.css" />
  <style>
    /* Page-local grid styling to guarantee visibility */
    .chapters-section{ padding:1.5rem 0 2.5rem; }
    .chapters-wrap{ display:flex; justify-content:center; }
    .chapters-grid{
      display:grid; grid-template-columns: repeat(11, 1fr);
      gap:.5rem; max-width:720px; width:100%;
    }
    .chapter-tile{
      display:flex; align-items:center; justify-content:center;
      height:44px; border:1px solid #e2e6ef; background:#fff; color:#0b2340;
      text-decoration:none; font-weight:600; border-radius:8px;
    }
    .chapter-tile:hover{ box-shadow:0 6px 16px rgba(0,0,0,.06); transform:translateY(-1px); }
    @media (max-width:700px){ .chapters-grid{ grid-template-columns: repeat(6, 1fr); } }
    @media (max-width:460px){ .chapters-grid{ grid-template-columns: repeat(5, 1fr); } }
  </style>
</head>
<body>
  <!-- Header partial -->
  <div id="site-header"></div>

  <main>
    <!-- Universal hero -->
    <section class="page-hero hero-texts">
      <div class="container">
        <h1 class="page-title" id="book-title">Loading…</h1>
        <p class="page-subtitle" id="book-desc"></p>
      </div>
      <div class="hero-divider"></div>
    </section>

    <!-- Breadcrumbs (under hero) -->
    <nav id="breadcrumbs" class="breadcrumb" aria-label="Breadcrumb" data-scope="texts"></nav>

    <!-- Chapters grid -->
    <section class="chapters-section">
      <div class="container">
        <h2 class="section-title" style="margin-bottom:.75rem;">Contents</h2>
        <div class="chapters-wrap">
          <div id="chapters-grid" class="chapters-grid" aria-label="Chapters"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer partial -->
  <div id="site-footer"></div>

  <!-- Partials + Breadcrumbs -->
  <script src="/israelite-research/js/include.js"></script>
  <script src="/israelite-research/js/breadcrumbs.js" defer></script>

  <!-- Book grid loader (absolute paths + safe fallbacks) -->
  <script>
    (async function(){
      const params = new URLSearchParams(location.search);
      const bookParam = params.get('book') || 'Genesis';

      const titleEl = document.getElementById('book-title');
      const descEl  = document.getElementById('book-desc');
      const gridEl  = document.getElementById('chapters-grid');

      // Helper: title-case fallback
      const titleCase = s => s.replace(/\b\w/g, c => c.toUpperCase());

      // 1) Set title immediately
      titleEl.textContent = bookParam;

      // 2) Try to load description
      try {
        const dres = await fetch('/israelite-research/data/tanakh/descriptions.json', {cache:'no-store'});
        if (dres.ok) {
          const descs = await dres.json();
          const key = bookParam.toLowerCase();
          descEl.textContent = (descs[key] || descs[bookParam] || '');
        }
      } catch {}

      // 3) Determine number of chapters
      let chapters = 50; // safe default for Genesis
      try {
        const bres = await fetch('/israelite-research/data/tanakh/books.json', {cache:'no-store'});
        if (bres.ok) {
          const books = await bres.json();
          const match = books.find(b =>
            (b.name && (b.name.toLowerCase() === bookParam.toLowerCase())) ||
            (b.slug && (b.slug.toLowerCase() === bookParam.toLowerCase()))
          );
          if (match && Number(match.chapters) > 0) chapters = Number(match.chapters);
        }
      } catch {}

      // 4) Render centered grid with links to chapter page
      const frag = document.createDocumentFragment();
      for (let i=1; i<=chapters; i++){
        const a = document.createElement('a');
        a.className = 'chapter-tile';
        a.href = `/israelite-research/tanakh/chapter.html?book=${encodeURIComponent(bookParam)}&chapter=${i}`;
        a.textContent = i;
        a.setAttribute('aria-label', `Open ${titleCase(bookParam)} ${i}`);
        frag.appendChild(a);
      }
      gridEl.innerHTML = '';
      gridEl.appendChild(frag);
    })();
  </script>
</body>
</html>
