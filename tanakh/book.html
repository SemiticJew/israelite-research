<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Book — Semitic Jew</title>
  <link rel="stylesheet" href="/israelite-research/styles.css" />
  <style>
    /* Page-local touches to ensure center + consistent layout */
    .book-hero .container { max-width: 1200px; margin: 0 auto; }
    .book-hero .page-title { margin-bottom: .35rem; }
    .book-hero .page-subtitle { max-width: 70ch; margin-inline: auto; }

    .book-meta { max-width: 1200px; margin: 0 auto; padding: var(--space-sm, 16px) 0; }
    .book-meta h2 { margin: 0 0 .5rem 0; font-size: 1rem; text-transform: uppercase; letter-spacing: .08em; color: var(--blue-100,#335); }

    .chapters { max-width: 1200px; margin: 0 auto; padding: var(--space-sm, 16px) 0 var(--space-lg, 48px); }
    .chapters .grid {
      display: grid;
      grid-auto-rows: 56px;
      grid-template-columns: repeat(auto-fill, 56px);
      gap: 10px;
      justify-content: center; /* centers the grid block itself */
    }
    .chapters .tile {
      display: grid;
      place-items: center;
      width: 56px; height: 56px;
      border: 1px solid #e6ebf2;
      background: #fff;
      text-decoration: none;
      color: #0b2340;
      font-weight: 600;
      border-radius: 8px; /* match site feel */
    }
    .chapters .tile:hover { box-shadow: 0 6px 16px rgba(0,0,0,.08); transform: translateY(-1px); }
    .chapters .tile:active { transform: translateY(0); }

    /* Keep breadcrumbs under hero across all pages */
    nav.breadcrumb { max-width: 1200px; margin: 0 auto; }
  </style>
</head>
<body class="book-page">
  <!-- Header partial -->
  <div id="site-header"></div>

  <main>
    <!-- Universal hero -->
    <section class="page-hero book-hero">
      <div class="container">
        <h1 id="bookTitle" class="page-title">Loading…</h1>
        <p id="bookDesc" class="page-subtitle"></p>
      </div>
      <div class="hero-divider"></div>
    </section>

    <!-- Breadcrumbs (under hero) -->
    <nav id="breadcrumbs" class="breadcrumb" aria-label="Breadcrumb" data-scope="texts"></nav>

    <!-- Contents + Chapters grid -->
    <section class="book-meta">
      <h2>Contents</h2>
      <p id="chaptersHint" class="muted" style="color:#666;margin:0;"></p>
    </section>

    <section class="chapters">
      <div id="chaptersGrid" class="grid" aria-label="Chapter list"></div>
    </section>
  </main>

  <!-- Footer partial -->
  <div id="site-footer"></div>

  <!-- Partials + Breadcrumbs -->
  <script src="/israelite-research/js/include.js"></script>
  <script src="/israelite-research/js/breadcrumbs.js" defer></script>

  <!-- Page logic: read ?book=, load counts/description, render centered grid -->
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      const rawBook = params.get('book') || 'Genesis';
      const book = decodeURIComponent(rawBook);

      // Set title immediately
      const titleEl = document.getElementById('bookTitle');
      const descEl  = document.getElementById('bookDesc');
      const hintEl  = document.getElementById('chaptersHint');
      const gridEl  = document.getElementById('chaptersGrid');

      titleEl.textContent = book;

      // Helper: slug folder is lowercase for files, per your repo layout
      const folder = book.toLowerCase().replace(/\s+/g, '');
      const booksJson = '/israelite-research/data/tanakh/books.json';
      const descJson  = '/israelite-research/data/tanakh/descriptions.json';

      // Load description (graceful if missing)
      fetch(descJson)
        .then(r => r.ok ? r.json() : {})
        .then(all => {
          if (all && all[book]) descEl.textContent = all[book];
          else descEl.textContent = '';
        })
        .catch(()=>{ descEl.textContent = ''; });

      // Load chapter count and render grid
      fetch(booksJson)
        .then(r => {
          if (!r.ok) throw new Error('books.json not found');
          return r.json();
        })
        .then(list => {
          const rec = Array.isArray(list) ? list.find(x => x.name === book) : null;
          const count = rec && rec.chapters ? Number(rec.chapters) : 50; // fallback
          hintEl.textContent = `Chapters ${count > 1 ? `1–${count}` : '1'}`;

          // Build centered tiles
          const frag = document.createDocumentFragment();
          for (let i = 1; i <= count; i++) {
            const a = document.createElement('a');
            a.className = 'tile';
            a.href = `/israelite-research/tanakh/chapter.html?book=${encodeURIComponent(book)}&chapter=${i}`;
            a.textContent = i;
            a.setAttribute('aria-label', `Go to ${book} chapter ${i}`);
            frag.appendChild(a);
          }
          gridEl.innerHTML = '';
          gridEl.appendChild(frag);

          // Update <title>
          document.title = `${book} — Semitic Jew`;

          // Nudge breadcrumbs (Home > Texts > Tanakh > Book)
          // breadcrumbs.js will render base trail; we can append current book name as last crumb if needed:
          document.addEventListener('breadcrumbs:ready', () => {
            const bc = document.getElementById('breadcrumbs');
            if (!bc) return;
            const last = bc.querySelector('ol');
            if (!last) return;
            // If the last item isn't already the book name, append it.
            const items = last.querySelectorAll('li');
            const already = items.length && items[items.length-1].textContent.trim() === book;
            if (!already) {
              const li = document.createElement('li');
              li.textContent = book;
              last.appendChild(li);
            }
          });
        })
        .catch(err => {
          hintEl.textContent = 'Chapters';
          gridEl.innerHTML = '<p style="color:#a00">Could not load chapters.</p>';
          console.error(err);
        });
    })();
  </script>
</body>
</html>
