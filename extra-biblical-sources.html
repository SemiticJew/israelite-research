<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Extra-Biblical Sources â€” amCharts Map</title>
<link rel="stylesheet" href="/israelite-research/styles.css"/>
<style>
  :root{--ink:#0b2340;--brand:#054A91;--muted:#6b7280}
  html,body{height:100%;margin:0;background:#fff;color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .container{max-width:1200px;margin:0 auto;padding:18px}
  .page-title{margin:.2rem 0 1rem;font-size:1.6rem;font-weight:800}
  .card{background:#fff;border:1px solid #e6ebf2;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06);overflow:hidden}
  .toolbar{display:flex;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid #eef2f7;flex-wrap:wrap}
  select{border:1px solid #cfd8e3;border-radius:10px;padding:.45rem .6rem;background:#fff;font:inherit}
  #chartdiv{width:100%;height:72vh;min-height:420px}
</style>
</head>
<body>
<div id="site-header"></div>

<main class="container">
  <h1 class="page-title">Interactive Map (amCharts v5)</h1>
  <section class="card">
    <div class="toolbar">
      <label for="mapSelect"><strong>View:</strong></label>
      <select id="mapSelect">
        <option value="world">World</option>
        <option value="middleEast" selected>Middle East</option>
      </select>
    </div>
    <div id="chartdiv"></div>
  </section>
</main>

<div id="site-footer"></div>

<script src="/israelite-research/js/shims.js" defer></script>
<script src="/israelite-research/js/include.js" defer></script>

<!-- amCharts v5 (CDN) -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<script>
am5.ready(function() {
  const MID_EAST = [
    "EGY","SDN","TUR","CYP","ISR","PSE","JOR","LBN","SYR",
    "IRQ","IRN","KWT","SAU","BHR","QAT","ARE","OMN","YEM"
  ];

  let root, chart, polygonSeries, zoomControl;

  function disposeAll() {
    if (root) { root.dispose(); root = null; }
  }

  function makeMap(view) {
    disposeAll();

    root = am5.Root.new("chartdiv");
    root.setThemes([ am5themes_Animated.new(root) ]);

    chart = root.container.children.push(am5map.MapChart.new(root, {
      panX: "rotateX",
      panY: "translateY",
      projection: am5map.geoNaturalEarth1()
    }));

    const seriesCfg = { geoJSON: am5geodata_worldLow };
    if (view === "middleEast") {
      seriesCfg.include = MID_EAST;
    } else {
      seriesCfg.exclude = ["AQ"];
    }

    polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, seriesCfg));

    polygonSeries.mapPolygons.template.setAll({
      tooltipText: "{name}",
      toggleKey: "active",
      interactive: true
    });

    polygonSeries.mapPolygons.template.states.create("hover", {
      fill: root.interfaceColors.get("primaryButtonHover")
    });
    polygonSeries.mapPolygons.template.states.create("active", {
      fill: root.interfaceColors.get("primaryButtonActive")
    });

    zoomControl = chart.set("zoomControl", am5map.ZoomControl.new(root, {}));
    zoomControl.homeButton.set("visible", true);
    zoomControl.homeButton.events.on("click", function() { chart.goHome(); });

    chart.chartContainer.get("background").events.on("click", function() { chart.goHome(); });

    chart.appear(600, 100);

    if (view === "middleEast") {
      // Zoom to the included polygons once ready
      polygonSeries.events.on("datavalidated", function() {
        polygonSeries.zoomToDataItems(polygonSeries.dataItems, 1.1, 0);
      });
    }
  }

  const select = document.getElementById("mapSelect");
  makeMap(select.value);

  select.addEventListener("change", () => makeMap(select.value));
});
</script>
</body>
</html>
