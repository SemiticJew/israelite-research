<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>Extra-Biblical Sources â€” Semitic Jew</title>
  <link href="/israelite-research/styles.css" rel="stylesheet"/>
  <style>
    :root{ --ink:#0b2340; --muted:#6b7280; --brand:#054A91; --accent:#F17300; --sky:#e7ecf4; }
    .container{ max-width:1200px; margin:0 auto; padding:0 16px; }
    .section{ padding:24px 0; }
    .title{ margin:0 0 8px; font:900 2rem/1.15 system-ui; color:var(--ink); }
    .sub{ color:var(--muted); max-width:70ch; }
    .sec-head{ display:flex; align-items:center; gap:10px; justify-content:space-between; margin:12px 0; }
    .sec-title{ margin:0; font:900 1.2rem/1.2 system-ui; color:var(--ink); }
    .tools{ display:flex; flex-wrap:wrap; gap:8px; }
    .select, .btn{ border:1px solid var(--sky); background:#fff; color:var(--ink); border-radius:999px; padding:8px 12px; font-weight:800; }
    .muted{ color:var(--muted); }

    .wheel-wrap{ display:block; position:relative; height:720px; border:1px solid var(--sky); border-radius:14px; background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.06); overflow:hidden; }
    .wheel{ --items:12; --radius:380px; --card-w:170px; --card-h:110px; list-style:none; margin:0; padding:0; position:absolute; inset:0; }
    .wheel > li{ position:absolute; top:50%; left:50%; transform-origin:0 0; will-change: transform; }
    .wheel input{ position:absolute; opacity:0; pointer-events:none; }
    .wheel label{
      display:block; width:var(--card-w); min-height:var(--card-h);
      padding:10px 12px; background:#fff; border:1px solid var(--sky); border-radius:12px;
      box-shadow:0 6px 24px rgba(0,0,0,.10);
      color:var(--ink); text-decoration:none; cursor:pointer; transition:transform .2s, box-shadow .2s, border-color .2s;
    }
    .wheel h3{ margin:0 0 4px; font:900 .95rem/1.15 system-ui; color:var(--ink); }
    .wheel p{ margin:0; color:var(--muted); font-size:.85rem; display:none; }
    .wheel input:checked + label{ border-color:#c6d6ea; box-shadow:0 10px 30px rgba(0,0,0,.18); transform:scale(1.03); z-index:2; }}
    .wheel input:checked + label p{ display:block; }
    .wheel .yr{ display:inline-block; font-weight:800; color:var(--brand); margin-right:6px; }

    @media (max-width:960px){ .wheel-wrap{ height:600px; } .wheel{ --radius:300px; --card-w:160px; } } .wheel{ --radius:240px; --card-w:180px; } }
    @media (max-width:640px){ .wheel-wrap{ height:560px; } .wheel{ --radius:240px; --card-w:150px; --card-h:100px; } .wheel h3{ font-size:.9rem; } .wheel p{ font-size:.8rem; } } .wheel{ --radius:200px; --card-w:170px; --card-h:110px; } .wheel h3{ font-size:.9rem; } .wheel p{ font-size:.82rem; } }
  </style>
</head>
<body>
<div id="site-header"></div>

<main class="container">
  <header class="section">
    <h1 class="title">Extra-Biblical Sources</h1>
    <p class="sub">Explore key events beyond the biblical text, filtered by book context to keep the wheel readable.</p>
  </header>

  <section class="section" id="wheel-only">
    <div class="sec-head">
      <h2 class="sec-title">Highlights Wheel</h2>
      <div class="tools">
        <select class="select" id="bookFilter" aria-label="Filter by Book">
          <option value="">All Books</option>
        </select>
        <select class="select" id="wheelCap" aria-label="Cards shown"><option>8</option><option selected>10</option><option>12</option><option>16</option></select>
        <span class="muted" id="wheelCount"></span>
      </div>
    </div>

    <div class="wheel-wrap">
      <ul class="wheel cards" id="wheelCards" style="--items:0" aria-label="Timeline highlights"></ul>
    </div>
  </section>
</main>

<div id="site-footer"></div>
<script src="/israelite-research/js/include.js"></script>

<script>
(function(){
  const CSV_SOURCES = [
    "/israelite-research/data/extra_sources.csv",
    "https://raw.githubusercontent.com/SemiticJew/israelite-research/main/israelite-research/data/extra_sources.csv"
  ];
  const UL=document.getElementById("wheelCards"); const CNT=document.getElementById("wheelCount"); const S=document.getElementById("bookFilter"); const CAP=document.getElementById("wheelCap");
  if(!UL || !S) return;

  const CANON = [
    "Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth",
    "1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther",
    "Job","Psalms","Proverbs","Ecclesiastes","Song of Songs","Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel",
    "Hosea","Joel","Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah","Malachi",
    "Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians",
    "Colossians","1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon","Hebrews",
    "James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"
  ];

  function toNum(x){ const n = Number(String(x||"").trim()); return Number.isFinite(n)? n : null; }
  function fmtYear(y){ return y < 0 ? (Math.abs(y) + " BCE") : (y + " CE"); }

  function parseCSV(text){
    const lines = text.split(/\r?\n/).filter(Boolean);
    if(!lines.length) return [];
    const head = lines.shift().split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(h=>h.trim());
    const idx  = Object.fromEntries(head.map((h,i)=>[h.toLowerCase(),i]));
    const get  = (cols, k) => (k in idx ? cols[idx[k]] : "");
    return lines.map(row=>{
      const cols = row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);
      const year = toNum(get(cols,"year"));
      const title= String(get(cols,"title")||"").trim();
      const summary = String(get(cols,"summary")||"").trim();
      const book = String(get(cols,"book")||"").trim();
      return {year,title,summary,book};
    }).filter(r => r.year!==null && r.title);
  }

  function inferBook(rec){
    const hay = (rec.title + " " + rec.summary).toLowerCase();
    for(const b of CANON){
      const patt = new RegExp("\\b" + b.replace(/[\s.]/g,'\\s*').toLowerCase() + "\\b");
      if(patt.test(hay)) return b;
    }
    return rec.book || "";
  }

  function sampleEven(items, n){
    if(items.length <= n) return items.slice();
    const out = [];
    for(let i=0;i<n;i++){
      const idx = Math.round(i*(items.length-1)/(n-1));
      out.push(items[idx]);
    }
    const seen = new Set(), dedup = [];
    for(const x of out){ const key = x.year+"|"+x.title; if(!seen.has(key)){ seen.add(key); dedup.push(x); } }
    return dedup;
  }

  function buildWheel(items){
    UL.innerHTML = "";
    if(!items.length){ UL.style.setProperty("--items", 0); if(CNT) CNT.textContent="0 highlights"; return; }
    UL.style.setProperty("--items", items.length);
    const radius = getComputedStyle(UL).getPropertyValue("--radius") || "240px";
    items.forEach((it, i) => {
      const li = document.createElement("li");
      const angle = (360 * i / items.length);
      li.style.transform = `rotate(${angle}deg) translate(${radius}) rotate(${-angle}deg)`;

      const inp = document.createElement("input");
      inp.type = "radio"; inp.name = "wheel"; inp.id = "wh-" + i;
      if(i===0) inp.checked = true;

      const lab = document.createElement("label");
      lab.setAttribute("for", inp.id);

      const h3 = document.createElement("h3");
      h3.textContent = it.title;

      const p = document.createElement("p");
      const yr = document.createElement("span");
      yr.className = "yr"; yr.textContent = fmtYear(it.year);
      p.appendChild(yr);
      if(it.summary){ p.appendChild(document.createTextNode(it.summary)); }

      lab.appendChild(h3); lab.appendChild(p);
      li.appendChild(inp); li.appendChild(lab);
      UL.appendChild(li);
    });
    if(CNT) CNT.textContent = items.length + " highlights";
  }

  function populateBookFilter(rows){
    const set = new Set();
    rows.forEach(r => { const b = r.book || inferBook(r); if(b) set.add(b); });
    const list = Array.from(set);
    list.sort((a,b)=> {
      const ia = CANON.indexOf(a), ib = CANON.indexOf(b);
      if(ia>=0 && ib>=0) return ia-ib;
      if(ia>=0) return -1; if(ib>=0) return 1;
      return a.localeCompare(b);
    });
    S.innerHTML = '<option value="">All Books</option>' + list.map(b=>`<option>${b}</option>`).join('');
  }

  function filterAndRender(all, book){ const cap = CAP ? parseInt(CAP.value,10) || 10 : 10;
    let rows = all.slice();
    if(book){ rows = rows.filter(r => (r.book || inferBook(r)) === book); }
    rows = rows.filter(r => r.year >= -4000 && r.year <= 2500).sort((a,b)=> a.year - b.year);
    const picks = sampleEven(rows, cap);
    buildWheel(picks);
  }

  (async function(){
    let text = null;
    for(const url of CSV_SOURCES){
      try{ const r = await fetch(url, {cache:"no-store"}); if(r.ok){ text = await r.text(); break; } }catch(e){}
    }
    if(text === null){ if(CNT) CNT.textContent="Failed to load data"; return; }

    const all = parseCSV(text).map(r => ({...r, book: r.book || inferBook(r)}));
    populateBookFilter(all);
    filterAndRender(all, S.value);

    S.addEventListener('change', () => filterAndRender(all, S.value));
  })();
})();
</script>
</body>
</html>
